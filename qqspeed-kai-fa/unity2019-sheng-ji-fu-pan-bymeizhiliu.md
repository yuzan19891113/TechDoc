# Unity2019升级复盘byMeiZhiLiu

Meizhiliu

## 渲染管线和引擎升级主要节点 <a id="%E6%B8%B2%E6%9F%93%E7%AE%A1%E7%BA%BF%E5%92%8C%E5%BC%95%E6%93%8E%E5%8D%87%E7%BA%A7%E4%B8%BB%E8%A6%81%E8%8A%82%E7%82%B9"></a>

![enter image description here](https://iwiki.woa.com/download/attachments/961927467/image-1629422442023.png?version=1&modificationDate=1629422441879&api=v2)

## 考验 <a id="%E8%80%83%E9%AA%8C"></a>

大升级很考验项目整个流程，放大小问题，暴露新问题

* **构建流程：** 曾经的特殊处理-如shader; 单次构建的耗时; 构建出错; ...
* **测试流程：** 渲染管线升级在分支测试报告性能ok，主线有问题; 引擎升级超高帧无案例; ...
* **引擎修改和合入** 短时间内（1个迭代）合入约70项，构建、Editor、出包验证、出问题排查等整体流程的考验，稳定、效率。

## 重新思考 <a id="%E9%87%8D%E6%96%B0%E6%80%9D%E8%80%83"></a>

* **游戏包二进制差异更新的支持** **差异更新分析：** 1.1.6G，下载、解包、安装时间 2.投入人力减少更新量 3.上线可能出问题 **全包更新分析：** 1.投入人力很少 2.升级所有资源，完全使用Unity2019的新方案 3.资源规则重新整理、统一
* **引擎升级安排** 工作量评估偏乐观（当时评估参考参考AOV升级、合金使用经验）； 分支上引擎升级功能和性能初步验证后，再在主线做引擎升级和大规模测试；
* **64位升级安排** 大项目最好在引擎升级之前完成64位升级
* **如何获得更多其他组的支持和认可** 升级需要全项目组认可和支持，确定目标后，尽早的一起投入和攻坚

## 遇上的棘手问题（其他项目未遇上） <a id="%E9%81%87%E4%B8%8A%E7%9A%84%E6%A3%98%E6%89%8B%E9%97%AE%E9%A2%98%EF%BC%88%E5%85%B6%E4%BB%96%E9%A1%B9%E7%9B%AE%E6%9C%AA%E9%81%87%E4%B8%8A%EF%BC%89"></a>

* **卡死问题** Texture Upload时 线程死锁（Unity bug）; Android平台信号量实现因内存顺序导致的卡死\(Unity bug\);
* **崩溃问题** mono heap暴涨到1G（GC算法黑名单机制）; 大内存对象难以被GC回收（保守GC机制）; 部分机器启动崩溃\(Unity bug\); 虚拟内存不足;
* **性能问题** 超高帧刷新率手机帧率下降（Unity bug）; 超高帧刷新率手机帧率稳定，但体验卡顿（Unity bug）;
* **二进制差异更新包量问题** 升级后AB自身差异变化; Mesh包量（FBX导入 optimize变化，m\_Skin变化）; Texture包量（ASTC压缩改变，unity使用策略，如alpha通道）;

